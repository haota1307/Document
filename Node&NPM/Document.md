# Node.js lÃ  gÃ¬? Táº¡i sao pháº£i há»c Node.js?

## Node.js lÃ  gÃ¬?

Javascript lÃ  ngÃ´n ngá»¯ láº­p trÃ¬nh, muá»‘n cháº¡y thÃ¬ cáº§n pháº£i cÃ³ mÃ´i trÆ°á»ng

MÃ´i trÆ°á»ng phá»• biáº¿n lÃ : TrÃ¬nh duyá»‡t, Node.Js, Deno, Bun,...

- Node.js lÃ  mÃ´i trÆ°á»ng cháº¡y Javascript ngoÃ i trÃ¬nh duyá»‡t, vÃ¬ tháº¿ nÃ³ cÃ³ thá»ƒ lÃ m server backend.

- Node.js thÃ¬ free, open source, cháº¡y Ä‘c trÃªn linux, mac, windows

- Chrome V8 JavaScript engine lÃ  nhÃ¢n cháº¡y Javascript cá»§a Node.Js, vÃ  cÃ¡i nhÃ¢n nÃ y cÅ©ng lÃ  nhÃ¢n cá»§a Chrome, Edge, Opera, Electron. Chrome V8 JavaScript engine nÃ³ Ä‘Æ°á»£c viáº¿t báº±ng C++

- NgoÃ i Chrome V8 JavaScript engine ra thÃ¬ cÃ²n vÃ i thá»© khÃ¡c Ä‘áº£m nhiá»‡m cÃ¡c vá»‹ trÃ­ khÃ¡c trong nodejs nhÆ°: libuv, c-ares,... nhÆ°ng thÃ´i, há»c Ä‘áº¿n Ä‘Ã¢u tÃ¬m hiá»ƒu Ä‘áº¿n Ä‘Ã³ ğŸ«¶ğŸ»

### Lá»‹ch sá»­ Node.js

- Node.js Ä‘Æ°á»£c táº¡o ra bá»Ÿi Ryan Dahl vÃ o nÄƒm 2009.

- Sau nÃ y Ryan Dahl táº¡o ra thÃªm Deno, nhÆ°ng Ä‘áº¿n nay váº«n khÃ¡ lÃ  Ã­t ngÆ°á»i dÃ¹ng Deno

## Táº¡i sao chá»n Node.js viáº¿t Backend mÃ  khÃ´ng pháº£i lÃ  PHP, Go, Java, .Net

- Node.Js viáº¿t báº±ng js, nÃªn má»™t láº­p trÃ¬nh viÃªn FE cÅ©ng cÃ³ thá»ƒ dá»… dÃ ng há»c vÃ  viáº¿t Ä‘Æ°á»£c BE. Tá»« Ä‘Ã³ tiáº¿t kiá»‡m chi phÃ­ nhÃ¢n sá»±

- Node.js cÃ³ hiá»‡u xuáº¥t nhanh hÆ¡n Ä‘Ã¡ng ká»ƒ khi so vá»›i PHP

- Máº·c dÃ¹ tá»‘c Ä‘á»™ thua Java, .Net, Go nhÆ°ng thá»±c táº¿ chÃºng ta khÃ´ng cáº§n nhiá»u tá»‘c Ä‘á»™ Ä‘áº¿n tháº¿. [Stack Exchange chá»‰ thá»±c thi 300 req/s](https://stackexchange.com/performance), Fastify Node.js cÃ³ thá»ƒ cho ra **45659 req/s**, vÃ  express lÃ  **9888 req/sec** (táº¥t nhiÃªn tÃ¹y vÃ o bÃ i test nhÆ°ng nÃ³ Ä‘á»§ Ä‘Ã¡p á»©ng nhu cáº§u chÃºng ta)

- Háº§u háº¿t cÃ¡c nÃºt tháº¯c cá»• chai á»Ÿ server náº±m á»Ÿ database chá»© Ã­t khi náº±m á»Ÿ ngÃ´n ngá»¯ chÃºng ta chá»n

> Náº¿u cáº£m tháº¥y Node.js cháº­m, khÃ´ng xá»­ lÃ½ Ä‘Æ°á»£c hÃ ng nghÃ¬n giao dá»‹ch má»—i giÃ¢y cá»§a báº¡n, chá»‰ cáº§n nÃ¢ng cáº¥p server! Easy!

- Nhu cáº§u viá»‡c lÃ m cá»§a Node.js cao tÆ°Æ¡ng Ä‘Æ°Æ¡ng PHP, Java, .Net

## Hiá»ƒu láº§m vá» Node.js vÃ  JavaScript

Ai cÅ©ng biáº¿t JavaScript lÃ  ngÃ´n ngá»¯ Ä‘Æ¡n luá»“ng, nhÆ°ng mÃ´i trÆ°á»ng cháº¡y cá»§a nÃ³ láº¡i khÃ¡c.

VÃ­ dá»¥ trÃ¬nh duyá»‡t, Ä‘Ã¢y lÃ  mÃ´i trÆ°á»ng Ä‘a luá»“ng, cÃ¡c WebAPI nhÆ° setTimeout Ä‘á»u cháº¡y á»Ÿ luá»“ng khÃ¡c

Node.js cÅ©ng tháº¿, nÃ³ cÃ³ thá»ƒ cháº¡y Ä‘a luá»“ng => cÃ³ thá»ƒ táº­n dá»¥ng Ä‘Æ°á»£c háº¿t sá»©c máº¡nh CPU ngÃ y nay

# CÃ i Ä‘áº·t NodeJS

CÃ³ thá»ƒ download nodejs á»Ÿ trang chá»§ [https://nodejs.org/en](https://nodejs.org/en) nhÆ°ng khÃ´ng nÃªn, vÃ¬ sau nÃ y ráº¥t khÃ³ Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c version khÃ¡c nhau

CÃ¡ch cÃ i thÃ´ng minh hÆ¡n lÃ  dÃ¹ng NVM, thÃ­ch version nÃ o thÃ¬ chuyá»ƒn sang version Ä‘Ã³, ráº¥t tiá»‡n

- Mac & Linux: [https://github.com/nvm-sh/nvm#install--update-script](https://github.com/nvm-sh/nvm#install--update-script)
- Window: [https://github.com/coreybutler/nvm-windows](https://github.com/coreybutler/nvm-windows)

Äá»ƒ biáº¿t cÃ i NVM thÃ nh cÃ´ng chÆ°a thÃ¬ dÃ¹ng

```bash
nvm list
```

CÃ i Node version má»›i nháº¥t

```bash
nvm install node
```

CÃ i Node version chá»‰ Ä‘á»‹nh

```bash
nvm install 14.7.0
```

Muá»‘n set default phiÃªn báº£n node nÃ o Ä‘Ã³, vÃ­ dá»¥ `14.7.0`

```bash
nvm alias default 14.7.0
```

# Webpack

## Webpack lÃ  gÃ¬?

- Webpack lÃ  má»™t tool cháº¡y trÃªn mÃ´i trÆ°á»ng NodeJs giÃºp chÃºng ta Ä‘Ã³ng gÃ³i cÃ¡c file js, css, sass, jpg...NgoÃ i ra webpack cÃ²n giÃºp chÃºng ta táº¡o má»™t server áº£o Ä‘á»ƒ thuáº­n tiá»‡n cho viá»‡c code.

## CÃ i `webpack` vÃ  `webpack-cli`

- ChÃºng ta cÃ i vÃ o trong devDependencies vÃ¬ tool nÃ y chá»‰ cháº¡y trong lÃºc chÃºng ta dev
- `webpack-cli` cÃ³ 2 cháº¿ Ä‘á»™ cÃ i lÃ  **global** vÃ  **local**. MÃ¬nh khuyÃªn cÃ¡c báº¡n cÃ i **local** cho dá»… quáº£n lÃ½.
- Cháº¡y cÃ¢u lá»‡nh `yarn add webpack webpack-cli -D` Ä‘á»ƒ cÃ i
- Má»Ÿ file `package.json` lÃªn Ä‘á»ƒ thÃªm dÃ²ng `"build": "webpack"` vÃ o trong `script`
- Máº·c Ä‘á»‹nh thÃ¬ `webpack` sáº½ sá»­ dá»¥ng thÆ° má»¥c `dist` Ä‘á»ƒ chá»©a nhá»¯ng file sau khi build vÃ  sá»­ dá»¥ng `src/index.js` Ä‘á»ƒ chá»©a file **entry** (file Ä‘áº§u vÃ o tá»•ng) cá»§a dá»± Ã¡n. Muá»‘n custom thÆ° má»¥c khÃ¡c hoáº·c cáº¥u hÃ¬nh sÃ¢u hÆ¡n thÃ¬ pháº£i táº¡o file config lÃ  `webpack.config.js`.
- Webpack sáº½ tá»± nháº­n diá»‡n file `webpack.config.js` vÃ  láº¥y nhá»¯ng config trong Ä‘Ã³. Náº¿u báº¡n táº¡o tÃªn file khÃ¡c `webpack.config.js` thÃ¬ pháº£i khai bÃ¡o nÃ³ trong Ä‘oáº¡n `script` cá»§a `package.json` Ä‘á»ƒ webpack biáº¿t.

**`webpack.config.js`**

```js
const path = require("path");
module.exports = {
  mode: "development",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
  },
};
```

## Sá»­ dá»¥ng cÃ¡c Loaders vÃ  biÃªn dá»‹ch SASS

- Náº¿u muá»‘n dÃ¹ng css trong webpack thÃ¬ báº¡n pháº£i cÃ i `style-loader` vÃ  `css-loader`
- Cháº¡y cÃ¢u lá»‡nh `yarn add style-loader css-loader -D` Ä‘á»ƒ cÃ i
- Muá»‘n dÃ¹ng thÃªm sass thÃ¬ pháº£i cÃ i thÃªm `sass` vÃ  `sass-loader`
- Cháº¡y cÃ¢u lá»‡nh `yarn add sass sass-loader -D` Ä‘á»ƒ cÃ i
- Sau khi build vÃ  cháº¡y thÃ¬ chÃºng ta sáº½ tháº¥y tháº» `<style>` Ä‘Æ°á»£c Javascript thao tÃ¡c DOM vÃ o trong file `index.html`. Náº¿u cÃ¡c báº¡n muá»‘n file css náº±m riÃªng biá»‡t thÃ¬ xem á»Ÿ bÆ°á»›c tiáº¿p theo nhÃ©.

**`webpack.config.js`**

```js
const path = require("path");
module.exports = {
  mode: "development",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss|css$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
    ],
  },
};
```

## Sá»­ dá»¥ng HTML Webpack Plugin Ä‘á»ƒ tá»± Ä‘á»™ng táº¡o ra file HTML

- BÃ¢y giá» cÃ³ 1 váº¥n Ä‘á» lÃ  chÃºng ta Ä‘ang chá»‰nh sá»­a cÃ¡c Ä‘Æ°á»ng dáº«n css vÃ  js báº±ng tay trong file `index.html`. Äiá»u nÃ y khÃ´ng hay chÃºt nÃ o vÃ¬ sau nÃ y cÃ¡c tÃªn file sáº½ lÃ  cÃ¡c hash name thÃ¬ viá»‡c cáº­p nháº­t láº¡i file `index.html` khÃ¡ máº¥t thá»i gian.
- `html-webpack-plugin` sáº½ giÃºp chÃºng ta tá»± táº¡o ra 1 file html báº±ng webpack theo cáº¥u hÃ¬nh cá»§a chÃºng ta.
- Cháº¡y cÃ¢u lá»‡nh `yarn add html-webpack-plugin -D` Ä‘á»ƒ cÃ i

**`webpack.config.js`**

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  mode: "production",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "[name].js",
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss|css$/,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      title: "Webpack App",
      filename: "index.html",
      template: "src/template.html",
    }),
  ],
};
```

## TÃ¡ch CSS ra nhá»¯ng file riÃªng

### Váº¥n Ä‘á» khi chÃ¨n `style` báº±ng JS

- Váº¥n Ä‘á» hiá»‡n táº¡i lÃ  CSS Ä‘ang Ä‘Æ°á»£c JS DOM vÃ o nÃªn xáº£y ra tÃ¬nh tráº¡ng "chá»›p tráº¯ng" khi má»›i load trang.
- TÄƒng size file JS lÃªn ráº¥t nhiá»u

### CÃ¡ch fix

- DÃ¹ng `mini-css-extract-plugin` Ä‘á»ƒ tÃ¡ch nÃ³ ra thÃ nh nhá»¯ng file riÃªng
- Cháº¡y cÃ¢u lá»‡nh `yarn add mini-css-extract-plugin -D` Ä‘á»ƒ cÃ i

### LÆ°u Ã½

- HÃ£y Ä‘áº£m báº£o báº¡n Ä‘Ã£ cÃ i vÃ  Ä‘ang dÃ¹ng plugin `html-webpack-plugin`, vÃ¬ nÃ³ cáº§n plugin nÃ y Ä‘á»ƒ tá»± Ä‘á»™ng generate ra tháº» `<link>` trong file `index.html`
- KhÃ´ng dÃ¹ng plugin `style-loader` cÃ¹ng vá»›i `mini-css-extract-plugin`. Náº¿u Ä‘ang dÃ¹ng `style-loader` thÃ¬ xÃ³a nÃ³ Ä‘i, 2 tháº±ng nÃ y xung Ä‘á»™t vá»›i nhau

**`webpack.config.js`**

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  mode: "production",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "[name].js",
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss|css$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin(),
    new HtmlWebpackPlugin({
      title: "Webpack App",
      filename: "index.html",
      template: "src/template.html",
    }),
  ],
};
```

## Xá»­ lÃ½ caching á»Ÿ trÃ¬nh duyá»‡t báº±ng hash name file

- Hiá»‡n táº¡i nhá»¯ng file css hay js sau khi build Ä‘á»u cÃ³ 1 cÃ¡i tÃªn cá»‘ Ä‘á»‹nh, Ä‘iá»u nÃ y dáº«n Ä‘áº¿n trÃ¬nh duyá»‡t hoáº·c server sáº½ thá»±c hiá»‡n caching. Caching lÃ  tá»‘t, Ä‘iá»u nÃ y giÃºp cho web chÃºng ta load nhanh hÆ¡n nhÆ°ng nÃ³ khÃ´ng Ä‘Ãºng vá»›i ngá»¯ cáº£nh hiá»‡n táº¡i. ChÃºng ta thÆ°á»ng build láº¡i webpack khi cÃ³ má»™t cáº­p nháº­t má»›i gÃ¬ Ä‘Ã³ trÃªn website vÃ  chÃºng ta muá»‘n ngÆ°á»i dÃ¹ng sáº½ tháº¥y ngay láº­p tá»©c báº£n cáº­p nháº­t nÃ y. VÃ¬ tháº¿ chÃºng ta cáº§n pháº£i xá»­ lÃ½ caching.
- CÃ¡ch xá»­ lÃ½ dá»… nháº¥t lÃ  má»—i láº§n build webpack chÃºng ta láº¡i táº¡o ra má»™t tÃªn file má»›i. Webpack cho phÃ©p chÃºng ta chá»‰nh sá»­a Ä‘iá»u nÃ y trong `output.filename` báº±ng `[contenthash]`

**`webpack.config.js`**

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  mode: "production",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "[name].[contenthash].js",
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss|css$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: "[name].[contenthash].css",
    }),
    new HtmlWebpackPlugin({
      title: "Webpack App",
      filename: "index.html",
      template: "src/template.html",
    }),
  ],
};
```

## Táº¡o má»™t server báº±ng webpack Ä‘á»ƒ dev

- Hiá»‡n táº¡i chÃºng ta Ä‘ang dÃ¹ng Live Server trÃªn VS code Ä‘á»ƒ tá»± Ä‘á»™ng reload láº¡i trang web. Webpack cung cáº¥p sáºµn cho chÃºng ta tÃ­nh nÄƒng táº¡o má»™t server localhost khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n extension VS code.
- Äá»ƒ sá»­ dá»¥ng thÃ¬ chÃºng ta cÃ i `webpack-dev-server`: `yarn add webpack-dev-server -D`
- ThÃªm script sau vÃ o `package.json`: `"start": "webpack serve"`

### LÆ°u Ã½

- `webpack-dev-server` cáº§n `html-webpack-plugin` Ä‘á»ƒ hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c.
- `webpack-dev-server` sáº½ lÆ°u cÃ¡c táº¡m cÃ¡c file cá»§a báº¡n vÃ o RAM, vÃ¬ tháº¿ báº¡n sáº½ khÃ´ng tháº¥y chÃºng á»Ÿ trong thÆ° má»¥c build (`dist`). KhÃ´ng tin thÃ¬ cÃ¡c báº¡n cÃ³ thá»ƒ xÃ³a thá»­ thÆ° má»¥c `dist` thÃ¬ server váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.

**`webpack.config.js`**

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  mode: "production",
  entry: {
    app: path.resolve("src/index.js"),
  },
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "[name].[contenthash].js",
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss|css$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: "[name].[contenthash].css",
    }),
    new HtmlWebpackPlugin({
      title: "Webpack App",
      filename: "index.html",
      template: "src/template.html",
    }),
  ],
  devServer: {
    static: {
      directory: "dist", // ÄÆ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i Ä‘áº¿n vá»›i thÆ° má»¥c chá»©a index.html
    },
    port: 3000, // Port thay cho port máº·c Ä‘á»‹nh (8080)
    open: true, // Má»Ÿ trang webpack khi cháº¡y terminal
    hot: true, // Báº­t tÃ­nh nÄƒng reload nhanh Hot Module Replacement
    compress: true, // Báº­t Gzip cho cÃ¡c tÃ i nguyÃªn
    historyApiFallback: true, // Set true náº¿u báº¡n dÃ¹ng cho cÃ¡c SPA vÃ  sá»­ dá»¥ng History API cá»§a HTML5
  },
};
```

## Dá»n dáº¹p thÆ° má»¥c build

- ThÃªm `output.clean = true` Ä‘á»ƒ dá»n dáº¹p thÆ° má»¥c `dist` sau má»—i láº§n build.

## Source map

- ThÃªm `devtool: 'source-map'` Ä‘á»ƒ cÃ³ `source-map` Ä‘áº§y Ä‘á»§ tiá»‡n lá»£i cho mÃ´i trÆ°á»ng dev.
- `source-map` sáº½ lÃ m cháº­m tiáº¿n trÃ¬nh build vÃ  rebuild.
- NgoÃ i `source-map` ra thÃ¬ cÃ²n cÃ³ cÃ¡c giÃ¡ trá»‹ khÃ¡c nhÆ° `eval`, `eval-cheap-source-map`,...tÃ¹y thuá»™c vÃ o má»¥c Ä‘Ã­ch sá»­ dá»¥ng.
- **KhuyÃªn dÃ¹ng**: Chá»‰ nÃªn Ä‘á»ƒ `source-map` khi dev, khi build ra production thÃ¬ hÃ£y disable nÃ³ Ä‘i vÃ¬ `source-map` sáº½ lÃ m lá»™ mÃ£ nguá»“n gá»‘c cÅ©ng nhÆ° lÃ  tÄƒng kÃ­ch thÆ°á»›c cÃ¡c file build.
- Webpack nháº­n cÃ¡c biáº¿n mÃ´i trÆ°á»ng thÃ´ng qua `--env` trong cÃ¢u lá»‡nh script khi cháº¡y webpack. VÃ¬ tháº¿ báº¡n hÃ£y thÃªm `"start": "webpack serve --env development"` trong script cá»§a `package.json` Ä‘á»ƒ truyá»n `development = true` vÃ o webpack. `module.exports` á»Ÿ file `webpack.config.js` ngoÃ i báº±ng má»™t object thÃ¬ nÃ³ cÃ²n cÃ³ thá»ƒ lÃ  má»™t function vá»›i tham sá»‘ lÃ  biáº¿n object mÃ´i trÆ°á»n env.
- Báº¡n cÅ©ng cÃ³ thá»ƒ truyá»n biáº¿n mÃ´i trÆ°á»ng vÃ o webpack thÃ´ng qua `process.env` cá»§a NodeJs. Náº¿u mÃ¡y windows thÃ¬ `"start": "SET NODE_ENV=production&webpack serve"`, cÃ²n Linux thÃ¬ `"start": "NODE_ENV=production webpack serve"`. BÃªn file `webpack.config.js` chá»‰ cáº§n dÃ¹ng `process.env.NODE_ENV` Ä‘á»ƒ nháº­n giÃ¡ trá»‹.

**`webpack.config.js`**

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = (env) => {
  const isDevelopment = Boolean(env.development);
  return {
    mode: isDevelopment ? "development" : "production",
    entry: {
      app: path.resolve("src/index.js"),
    },
    output: {
      path: path.resolve(__dirname, "dist"),
      filename: "[name].[contenthash].js",
      clean: true,
    },
    devtool: isDevelopment ? "source-map" : false,
    module: {
      rules: [
        {
          test: /\.s[ac]ss|css$/,
          use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
        },
      ],
    },
    plugins: [
      new MiniCssExtractPlugin({
        filename: "[name].[contenthash].css",
      }),
      new HtmlWebpackPlugin({
        title: "Webpack App",
        filename: "index.html",
        template: "src/template.html",
      }),
    ],
    devServer: {
      static: {
        directory: "dist", // ÄÆ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i Ä‘áº¿n vá»›i thÆ° má»¥c chá»©a index.html
      },
      port: 3000, // Port thay cho port máº·c Ä‘á»‹nh
      open: true, // Má»Ÿ trang webpack khi cháº¡y terminal
      hot: true, // Báº­t tÃ­nh nÄƒng reload nhanh Hot Module Replacement
      compress: true, // Báº­t Gzip cho cÃ¡c tÃ i nguyÃªn
      historyApiFallback: true, // Set true náº¿u báº¡n dÃ¹ng cho cÃ¡c SPA vÃ  sá»­ dá»¥ng History API cá»§a HTML5
    },
  };
};
```

## DÃ¹ng Babel Ä‘á»ƒ dá»‹ch code JS thÃ nh cÃ¡c phiÃªn báº£n cÅ© hÆ¡n

- Náº¿u nhÆ° chÃºng ta viáº¿t code JS cÃ³ cÃ¡c cÃº phÃ¡p cá»§a phiÃªn báº£n ES2022 thÃ¬ nhá»¯ng trÃ¬nh duyá»‡t cÅ© chá»‰ cháº¡y Ä‘Æ°á»£c ES6 sáº½ khÃ´ng thá»ƒ hiá»ƒu Ä‘Æ°á»£c code vÃ  dáº«n Ä‘áº¿n lá»—i. VÃ¬ tháº¿ transpile code thÃ nh cÃ¡c version cÅ© hÆ¡n lÃ  cáº§n thiáº¿t. CÃ´ng cá»¥ transpile phá»• biáº¿n nháº¥t lÃ  **Babel**
- Äá»ƒ sá»­ dá»¥ng Babel á»Ÿ webpack cÃ¡c báº¡n cáº§n cÃ i `yarn add @babel/core @babel/preset-env babel-loader -D`.

- Äá»ƒ mÃ¬nh giáº£i thÃ­ch luÃ´n tháº±ng `@babel/core` lÃ  lÃµi cá»§a Babel
- `@babel/preset-env` lÃ  bá»™ preset (thiáº¿t láº­p sáºµn) cho tá»«ng Ä‘á»‘i tÆ°á»£ng mÃ´i trÆ°á»ng
- `babel-loader` dÃ¹ng Ä‘á»ƒ tÃ­ch há»£p Babel vÃ o webpack.
- Tiáº¿p theo cÃ¡c báº¡n thÃªm cÃ¡i nÃ y vÃ o rules lÃ  Ä‘Æ°á»£c.

```js
{
  test: /\.js$/,
  exclude: /node_modules/,
  use: {
    loader: 'babel-loader',
    options: {
      presets: ['@babel/preset-env']
    }
  }
}
```

- ChÃºng ta exclude `node_modules` vÃ¬ quÃ¡ trÃ¬nh dá»‹ch code lÃ  quÃ¡ trÃ¬nh ráº¥t náº·ng vÃ  cháº­m. HÃ£y Ä‘áº£m báº£o chÃºng ta cáº§n dá»‹ch Ã­t code nháº¥t cÃ³ thá»ƒ, vÃ¬ tháº¿ chÃºng ta khÃ´ng cáº§n dá»‹ch code tá»« cÃ¡c package trong `node_module`, nhá»¯ng package nÃ y Ä‘a sá»‘ Ä‘Ã£ Ä‘Æ°á»£c dá»‹ch Ä‘á»ƒ cháº¡y Ä‘Æ°á»£c á»Ÿ Ä‘a sá»‘ trÃ¬nh duyá»‡t phá»• biáº¿n rá»“i.

- Trá»« nhá»¯ng trÆ°á»ng há»£p Ä‘áº·c biá»‡t báº¡n váº«n pháº£i dá»‹ch má»™t sá»‘ thÆ° viá»‡n trong `node_module`. LÃºc nÃ y cÃ³ thá»ƒ káº¿t há»£p `test` vÃ  `not` nhÆ° dÆ°á»›i Ä‘Ã¢y.

```js
{
    test: /\.m?js$/,
    exclude: {
      and: [/node_modules/], // Exclude libraries in node_modules ...
      not: [
        // Except for a few of them that needs to be transpiled because they use modern syntax
        /unfetch/,
        /d3-array|d3-scale/,
        /@hapi[\\/]joi-date/,
      ]
    },
    use: {
      loader: 'babel-loader',
      options: {
        presets: [
          ['@babel/preset-env']
        ]
      }
    }
  }
```

- Náº¿u khÃ´ng Ä‘áº·t `target` cho `@babel/preset-env` thÃ¬ [Babel sáº½ cho ráº±ng báº¡n Ä‘ang target Ä‘áº¿n cÃ¡c trÃ¬nh duyá»‡t cÅ© nháº¥t cÃ³ thá»ƒ, vÃ­ dá»¥ `@babel/preset-env` sáº½ dá»‹ch code ES2015-ES2020 sang ES5](https://babeljs.io/docs/en/options#no-targets). Váº­y nÃªn báº¡n nÃªn Ä‘áº·t `target` Ä‘á»ƒ cÃ³ thá»ƒ giáº£m kÃ­ch thÆ°á»›c file build.

- á» pháº§n [doc `targets` cá»§a @babel/preset-env](https://babeljs.io/docs/en/babel-preset-env#targets) thÃ¬ chÃºng ta cÃ³ thá»ƒ truyá»n tháº±ng targets vÃ o cÃ¡i option nÃ y kiá»ƒu nhÆ° phÃ­a dÆ°á»›i

```js
presets: [["@babel/preset-env", { targets: "ie 11" }]];
```

- NhÆ°ng theo mÃ¬nh test thÃ¬ nÃ³ khÃ´ng hiá»‡u quáº£, arrow function váº«n xuáº¥t hiá»ƒn á»Ÿ file build cho **ie 11**. CÃ³ váº» cÃ¡i targets option nÃ y khÃ´ng hoáº¡t Ä‘á»™ng tá»‘t Ä‘á»‘i vá»›i nhá»¯ng trÃ¬nh duyá»‡t cÅ©. NhÆ°ng náº¿u chÃºng ta lÃ m theo [doc nÃ³ recommend lÃ  táº¡o file `.browserslistrc`](https://babeljs.io/docs/en/babel-preset-env#browserslist-integration) Ä‘á»ƒ setting cho cÃ¡i targets thÃ¬ láº¡i hoáº¡t Ä‘á»™ng tá»‘t.

- **Browserslist** lÃ  má»™t thÆ° viá»‡n giÃºp chÃºng ta config target browsers hoáº·c node.js. CÃ¡ch viáº¿t Browserslist cÃ³ thá»ƒ tham kháº£o táº¡i [doc cá»§a nÃ³](https://github.com/browserslist/browserslist)

**`.browserslistrc`**

```bash
ie 11
```

### LÆ°u Ã½ vá»›i @babel/preset-env

- KhÃ´ng pháº£i chá»‰ cáº§n set targets lÃ  táº¥t cáº£ code cháº¡y Ä‘Æ°á»£c trÃªn mÃ´i trÆ°á»ng mong muá»‘n, Ä‘Ã´i lÃºc báº¡n pháº£i setting má»™t sá»‘ thá»©.

- VÃ­ dá»¥ sá»­ dá»¥ng cÃº phÃ¡p ES6 Spread Operator cÃ³ thá»ƒ dá»‹ch sang Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i **ie 11** mÃ  khÃ´ng cáº§n setting gÃ¬ nhiá»u cho `@babel/preset-env`

**`index.js`**

```js
// ES6 Spread Operator
const person = { name: "Duoc" };
const personClone = { ...person };
console.log("personClone", personClone);
```

**`webpack.config.js`**

```js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      use: {
        loader: "babel-loader",
        options: {
          presets: [["@babel/preset-env"]],
        },
      },
    },
  ];
}
```

- NhÆ°ng náº¿u báº¡n dÃ¹ng cÃº phÃ¡p ES7 `Object.values` thÃ¬ báº¡n pháº£i setting má»™t chÃºt nÃ³ má»›i hoáº¡t Ä‘á»™ng.

- TrÆ°á»›c tiÃªn báº¡n cáº§n cÃ i `yarn add core-js -D`. **`core-js`** lÃ  má»™t thÆ° viá»‡n tiÃªu chuáº©n chá»©a cÃ¡c tÃ­nh nÄƒng cá»§a javascript, nÃ³ cÃ²n chá»©a cÃ¡c polyfill (nhá»¯ng Ä‘oáº¡n code dá»± phÃ²ng cho nhá»¯ng tÃ­nh nÄƒng má»›i mÃ  mÃ´i trÆ°á»ng hiá»‡n táº¡i khÃ´ng há»— trá»£)

**`index.js`**

```js
// ES6 Spread Operator
const person = { name: "Duoc" };
const personClone = { ...person };
console.log("personClone", personClone);

// ES7 Object.values
console.log("Object.values", Object.values(personClone));
```

**`webpack.config.js`**

```js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      use: {
        loader: "babel-loader",
        options: {
          presets: [
            [
              "@babel/preset-env",
              {
                debug: true, // Hiá»ƒn thá»‹ debug lÃªn terminal Ä‘á»ƒ dá»… debug
                useBuiltIns: "usage", // DÃ¹ng cÃ¡i nÃ y thÃ¬ Ä‘Æ¡n giáº£n nháº¥t, khÃ´ng cáº§n import core-js vÃ o code
                corejs: "3.23.4", // nÃªn quy Ä‘á»‹nh verson core-js Ä‘á»ƒ babel-preset-env nÃ³ hoáº¡t Ä‘á»™ng tá»‘i Æ°u
              },
            ],
          ],
        },
      },
    },
  ];
}
```

NgoÃ i ra Ä‘á»ƒ cho thuáº­n tiá»‡n viá»‡c tá»‘i Æ°u kÃ­ch thÆ°á»›c file build báº¡n cÅ©ng cÃ³ thá»ƒ dÃ¹ng `useBuiltIns: 'entry'`, lÃºc nÃ y thÃ¬ báº¡n pháº£i tá»± tay import cÃ¡c tÃ­nh nÄƒng cáº§n dÃ¹ng. VÃ­ dá»¥

**`index.js`**

```js
import "core-js/modules/es.object.values";
import "core-js/modules/es.promise";

import sum from "./utils";
import "./styles/style.css";
import "./styles/style.scss";
console.log(sum(100, 10));
// ES6 Spread Operator
const person = { name: "Duoc" };
const personClone = { ...person };
console.log("personClone", personClone);

// ES7 Object.values
console.log("Object.values", Object.values(personClone));
```

## [Sá»­ dá»¥ng cÃ¡c tÃ i nguyÃªn nhÆ° áº£nh trong webpack](https://webpack.js.org/guides/asset-modules/)

- Webpack 5 cho phÃ©p chÃºng ta sá»­ dá»¥ng cÃ¡c file nhÆ° (áº£nh, fonts, pdf...) trong webpack mÃ  khÃ´ng cáº§n cÃ i thÃªm cÃ¡c loader (trÆ°á»›c webpack 5 thÃ¬ cáº§n cÃ i cÃ¡c loader nhÆ° [file-loader](https://v4.webpack.js.org/loaders/file-loader/))

**`style.css`**

```css
@font-face {
  font-family: "Roboto";
  src: url("../fonts/Roboto-Regular.ttf") format("truetype");
  font-weight: 400;
}

body {
  background-color: aqua;
  font-family: "Roboto", sans-serif;
}
```

**`dom.js`**

```js
import wallpaper from "./images/pexels-maxime-francis.jpg";
import bitcoinWhitepaper from "./pdfs/bitcoin.pdf";

const domHandler = () => {
  console.log(wallpaper);
  console.log(bitcoinWhitepaper);
  document.body.style.backgroundImage = `url(${wallpaper})`;
  const link = document.createElement("a");
  link.href = bitcoinWhitepaper;
  link.textContent = "Bitcoin Whitepaper";
  document.body.appendChild(link);
};

export default domHandler;
```

**`webpack.config.js`**

```js
module.exports = {
  //...
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "[name].[contenthash].js",
    clean: true,
    assetModuleFilename: "[file]",
  },
  module: {
    rules: [
      {
        test: /\.(png|svg|jpg|jpeg|gif|pdf)$/i,
        type: "asset/resource",
      },
    ],
  },
};
```

- MÃ¬nh khÃ´ng bá» pháº§n má»Ÿ rá»™ng cá»§a file font vÃ o `test` font mÃ¬nh import trong file css vÃ  webpack nÃ³ tá»± Ä‘á»™ng load cho mÃ¬nh rá»“i.

Tham kháº£o cÃ¡ch viáº¿t template string cho [filename](https://webpack.js.org/configuration/output/#template-strings) vÃ  [assetModuleFilename](https://webpack.js.org/configuration/output/#outputassetmodulefilename)

> **Tip**
>
> - `[file]`: tÃªn file vÃ  Ä‘Æ°á»ng dáº«n, khÃ´ng cÃ³ query vÃ  fragment
> - `[query]`: query báº¯t Ä‘áº§u vá»›i dáº¥u `?`. VÃ­ dá»¥: abc.com/bitcoin.pdf?id=abcdef, khi ngÆ°á»i dÃ¹ng click vÃ o link nÃ y sáº½ xem Ä‘Æ°á»£c file pdf vÃ  server cÅ©ng nháº­n Ä‘Æ°á»£c má»™t request cÃ³ query string id=abcdef Ä‘á»ƒ thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng gÃ¬ Ä‘Ã³.
> - `[fragment]`: fragment báº¯t Ä‘áº§u vá»›i dáº¥u `#`. VÃ­ dá»¥ abc.com/bitcoin.pdf#page=4, khi ngÆ°á»i dÃ¹ng click vÃ o link nÃ y thÃ¬ má»Ÿ file pdf vÃ  chuyá»ƒn ngay Ä‘áº¿n page 4. Tham kháº£o thÃªm vá» URI fragment [táº¡i Ä‘Ã¢y](https://en.wikipedia.org/wiki/URI_fragment)
> - `[base]`: Chá»‰ tÃªn file (bao gá»“m pháº§n má»Ÿ rá»™ng), khÃ´ng cÃ³ Ä‘Æ°á»ng dáº«n
> - `[path]`: Chá»‰ cÃ³ Ä‘Æ°á»ng dáº«n, khÃ´ng cÃ³ tÃªn file
> - `[name]`: Chá»‰ cÃ³ tÃªn file mÃ  khÃ´ng cÃ³ pháº§n Ä‘uÃ´i má»Ÿ rá»™ng hay Ä‘Æ°á»ng dáº«n
> - `[ext]`: Pháº§n Ä‘uÃ´i má»Ÿ rá»™ng báº¯t Ä‘áº§u vá»›i dáº¥u `.` (tÃ­nh nÄƒng nÃ y khÃ´ng cÃ³ sáºµn cho [output,filename](https://webpack.js.org/configuration/output/#outputfilename))

- `[file]` = `[path][base]`
- `[base]` = `[name][ext]`
- Full path: `[path][name][ext][query][fragment]` = `[path][base][query][fragment]` = `[file][query][fragment]`.
- Thá»±c ra trong Ä‘a sá»‘ trÆ°á»ng há»£p cÃ¡c báº¡n chá»‰ cáº§n dÃ¹ng `[file]` lÃ  Ä‘á»§ rá»“i. `[query]` vÃ  `[fragment]` cá»±c Ã­t dÃ¹ng, chÆ°a ká»ƒ náº¿u chá»‰ Ã¡p dá»¥ng fragment khi import file cÃ²n lÃ m tÃªn file bá»‹ lá»—i => 404 not found

## PhÃ¢n tÃ­ch file build vá»›i Webpack Bundle Analyzer

- CÃ i `yarn add -D webpack-bundle-analyzer`

**`webpack.config.js`**

```js
const BundleAnalyzerPlugin =
  require("webpack-bundle-analyzer").BundleAnalyzerPlugin;

module.exports = (env) => {
  const basePlugins = [
    new MiniCssExtractPlugin({
      filename: "[name].[contenthash].css",
    }),
    new HtmlWebpackPlugin({
      title: "Webpack App",
      filename: "index.html",
      template: "src/template.html",
    }),
  ];

  const isDevelopment = Boolean(env.development);
  const plugins = isDevelopment
    ? basePlugins
    : [...basePlugins, new BundleAnalyzerPlugin()];
  return {
    //...
    plugins,
  };
};
```
